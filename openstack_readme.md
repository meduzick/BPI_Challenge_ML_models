## Оглавление
*  [Доступ к openstack](#доступ-к-openstack)
*  [Настройка VPN](#настройка-vpn)
*  [Авторизация с помощью СМС](#авторизация-с-помощью-смс)
*  [Подключение к инстансу по ssh](#подключение-к-инстансу-по-ssh)
*  [Доступ к jupyter notebook через браузер](#доступ-к-jupyter-notebook-через-браузер)
*  [Получение пары ключей](#получение-пары-ключей)
*  [Информация от администратора](#информация-от-администратора)
*  [Настройка ssh-проксирования через джамп-сервер](#настройка-ssh-проксирования-через-джамп-сервер)


### Доступ к openstack
1. [Установить vpn-подключение](#настройка-vpn).
2. [Настроить SOCKS5-прокси через джамп-сервер (ds-jump-srv01)](https://www.digitalocean.com/community/tutorials/how-to-route-web-traffic-securely-without-a-vpn-using-a-socks-tunnel).
Т. е., например, в случае Ubuntu выполнить команду
```
ssh %имя_пользователя%@ds-jump-srv01 -D 8123 -f -C -q -N
```
, а затем настроить SOCKS5-проксирование на localhost:8123 в любом браузере (команда создает фоновый локальный SOCKS5-сервер, имя пользователя и пароль - те, что используется на рабочем ПК). Случай Firefox рассмотрен в вышеуказанном руководстве, для Chrome можно использовать Proxy Helper.
3. В браузере, используя SOCKS5-прокси, зайти на https://ds.tinkoff.cloud/horizon, при необходимости разрешить незащищенное подключение.
4. Для входа использовать имя пользователя и пароль рабочего ПК.


### Настройка VPN
1. Перейти по ссылке https://gw-vpn.tcsbank.ru.
2. [Авторизоваться с помощью СМС](#авторизация-с-помощью-смс).
3. С открывшейся страницы скачать vpn-клиент Cisco AnyConnect.
4. При необходимости установить Java.
5. Установить Cisco AnyConnect.
6. Запустить Cisco AnyConnect GUI (C:\Program Files(x86)\Cisco\Cisco AnyConnect Secure Mobility Client\vpnui.exe в случае Windows, в Ubuntu можно найти в Dash после установки).
7. [Авторизоваться с помощью СМС](#авторизация-с-помощью-смс).


### Авторизация с помощью СМС
1. Выбрать группу TCS.
2. Ввести имя пользователя (то, что используется на рабочем ПК).
3. В качестве пароля ввести password.
4. Первая авторизация будет неудачной, придет СМС со временным паролем.
5. Ввести имя пользователя и временный пароль, войти.


### Подключение к инстансу по ssh
1. [Получить информацию от администратора](#информация-от-администратора).
2. [Настроить ssh-проксирование через джамп-сервер](#настройка-проксирования-через-джамп-сервер)
3. Зайти с помощью приватного ключа:
```
ssh laborant@ip_инстанса -i приватный_ключ.pem
```


### Доступ к jupyter notebook через браузер
1. [Получить информацию от администратора](#информация-от-администратора).
2. [Настроить ssh-проксирование через джамп-сервер](#настройка-проксирования-через-джамп-сервер)
3. Пробросить порт 8888 с инстанса:
```
ssh -4 -N -L 8888:127.0.0.1:8888 laborant@ip_инстанса -i приватный_ключ.pem
```
4. С помощью браузера войти на localhost:8888, ввести пароль от jupyter notebook.


### Получение пары ключей
1. [Получить доступ к openstack](#доступ-к-openstack).
2. Зайти на https://ds.tinkoff.cloud/horizon/project/access_and_security/.
3. Выбрать "Создать ключевую пару".
4. Скачать приватную часть ключа (важно, единственная возможность!).
5. Сменить права на приватную часть ключа:
```
chmod 600 приватный_ключ.pem
```
6. В подробной информации о ключе можно найти публичную часть (вида ssh-rsa ...).


### Информация от администратора
1. [Получить пару ключей](#получение-пары-ключей).
2. Передать публичную часть ключа администратору, запросить информацию об инстансе.
3. Будут получены: ip инстанса, пароль пользователя laborant на инстансе, пароль от jupyter notebook.


### Настройка ssh-проксирования через джамп-сервер
1. Создать файл ~/.ssh/config (если нет) и добавить следующее содержимое:
```
Host ip_инстанса
  ProxyCommand ssh логин@ds-jump-srv01 -W %h:%p
```
2. Установить корректные права:
```
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
